<div>
  {% comment %}
    Start of Cash on Delivery postal code checker snippet
    Instructions:
      1.Customize title, available, unavailable and placeholder messages below.
      2.Customize success and failure colors.
      3.Adjust the pixel spacing value (default 20) to best match the surroundings of the snippet.
        This will adjust spacing above and below the snippet.
  {% endcomment %}
  {% assign title                   = 'Check COD Availability' %}
  {% assign cod_available_message   = 'Cash on Delivery is available!' %}
  {% assign cod_unavailable_message = 'Cash on Delivery is not available to this postal code.' %}
  {% assign placeholder_message     = 'Postal code e.g. 414001' %}
  {% assign check_button_text       = 'Check' %}
  {% assign success_color           = '#468847' %}
  {% assign failure_color           = '#FF0000' %}
  {% assign spacing_in_pixels       = 20 %}
  <h3 style='font-size: 18px; margin: {{ spacing_in_pixels | append: 'px' }} 0'>{{ title | escape }}</h3>
  <div style='display: flex; margin-bottom: {{ spacing_in_pixels | append: 'px' }};'>
    <input type='text' id='PostalCode' name='PostalCode' placeholder='{{ placeholder_message | escape }}' style='margin: 0 {{ spacing_in_pixels | divided_by: 2 | append: 'px' }} 0 0;' onkeypress='return event.keyCode != 13;' />
    <button type='button' class='btn button' onclick='checkCodAvailability()'>{{ check_button_text | escape }}</button>
  </div>
  <p id='PostalCodeCheckerAvailability' style='display: none;'></p>
  
  <a id="viewCodTnC" style="cursor: pointer; color:blue; border-bottom: 1px solid; text-align: left;">View COD Terms & Conditions</a>
  <div id="CodTnc" style="display:none; margin-top:10px; text-align: left;">
    <ol>
      <li>Cash on delivery is only accepted for orders above Rs. 2000 and below Rs. 8000.</li>
      <li>Cash on delivery is only serviceable in specific cities and pin codes. You can check if your location is eligible for COD via the availability checker above.</li>
      <li>In case of COD orders, order confirmation will be required from the recipient over call. Orders will not be dispatched until phone confirmation is completed.</li>
      <li>COD payment can be accepted by cash or credit/debit card. E-vouchers, store credit or foreign currency cannot be accepted as mode of payment.</li>
      <li>For COD orders refunds will be provided via store credit equivalent to the total order value. We cannot refund the amount by any other method, such as UPI or bank transfer.</li>
      <li>Any dispute arising due to COD is subject to the jurisdiction of Bangalore, Karnataka.</li>
    </ol>
  </div>
  
</div>
<script type='text/javascript'>
  var checkCodAvailability = function() {
    var url = 'https://cod.shopifyapps.com/payment/check';
    var box = document.getElementById('PostalCodeCheckerAvailability');
    var postalCode = document.getElementById('PostalCode').value;
    box.style.display = 'block';
    box.style.visibility = 'hidden';
    var xhr = new XMLHttpRequest();
    xhr.open('POST', url);
    xhr.setRequestHeader('Content-Type', 'application/json');
    xhr.setRequestHeader('Accept', 'application/json');
    xhr.onreadystatechange = function() {
      if (xhr.readyState == 4) {
        var result = JSON.parse(xhr.responseText);
        if (xhr.status == 200) {
          if (result.cod_available == true) {
            box.textContent = {{ cod_available_message | json }};
            box.style.color = {{ success_color | json }};
          } else {
            box.textContent = {{ cod_unavailable_message | json }};
            box.style.color = {{ failure_color | json }};
          }
        } else {
          box.textContent = result.errors;
          box.style.color = {{ failure_color | json }};
        }
        box.style.visibility = 'visible';
      }
    }
    // CAUTION: Changing these parameter names will break this snippet.
    params = {
      x_account_id: {{ shop.permanent_domain | json }},
      zip_code: postalCode
    }
    xhr.send(JSON.stringify(params));
  }
  
  
  var viewTnc = document.getElementById('viewCodTnC');
  var tnc = document.getElementById('CodTnc');
  
  viewTnc.addEventListener("click", function(){
    viewTnc.style.display = "none";
  	tnc.style.display = "block";
  });
  
</script>
{% comment %} End of Cash on Delivery postal code checker snippet {% endcomment %}